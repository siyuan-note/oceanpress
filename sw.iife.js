var co=Object.defineProperty;var es=E=>{throw TypeError(E)};var lo=(E,v,T)=>v in E?co(E,v,{enumerable:!0,configurable:!0,writable:!0,value:T}):E[v]=T;var g=(E,v,T)=>lo(E,typeof v!="symbol"?v+"":v,T),$r=(E,v,T)=>v.has(E)||es("Cannot "+T);var l=(E,v,T)=>($r(E,v,"read from private field"),T?T.call(E):v.get(E)),y=(E,v,T)=>v.has(E)?es("Cannot add the same private member more than once"):v instanceof WeakSet?v.add(E):v.set(E,T),w=(E,v,T,Ve)=>($r(E,v,"write to private field"),Ve?Ve.call(E,T):v.set(E,T),T),_=(E,v,T)=>($r(E,v,"access private method"),T);var ts=(E,v,T,Ve)=>({set _(Jt){w(E,v,Jt,T)},get _(){return l(E,v,Ve)}});(function(){"use strict";var Ye,X,fe,rs,ns,Dr,Ne,Kn,_t,bt,de,Ce,he,D,R,se,pe,Et,Qe,Xe,xt,Nt,H,G,Un,Z,O,ss,ge,He,Ut,zt,zn,Me,je,ee,Jn,Kt,St,Gn,Se,$e,Ze,is,os,Yn,De,we,Qn,Te,A,Ae,et,j,me,Le,Xn,Be,Zn;const E=()=>{throw new Error("不可调用未填充的依赖")},v={setItem:E,getItem:E,getNodeByID:E,getDocPathBySY:E,getDocByChildID:E,getHPathByID_Node:E};function T(e){return`data/${e.box}${e.path}`}var Ve={};/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Jt(e){const t=Object.create(null);for(const r of e.split(","))t[r]=1;return r=>r in t}const rt=Ve.NODE_ENV!=="production"?Object.freeze({}):{},nt=()=>{},Fe=Object.assign,as=Object.prototype.hasOwnProperty,Gt=(e,t)=>as.call(e,t),U=Array.isArray,We=e=>$t(e)==="[object Map]",cs=e=>$t(e)==="[object Set]",F=e=>typeof e=="function",Tr=e=>typeof e=="string",st=e=>typeof e=="symbol",ie=e=>e!==null&&typeof e=="object",ls=e=>(ie(e)||F(e))&&F(e.then)&&F(e.catch),us=Object.prototype.toString,$t=e=>us.call(e),Rr=e=>$t(e).slice(8,-1),fs=e=>$t(e)==="[object Object]",Yt=e=>Tr(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,ds=(e=>{const t=Object.create(null);return r=>t[r]||(t[r]=e(r))})(e=>e.charAt(0).toUpperCase()+e.slice(1)),ke=(e,t)=>!Object.is(e,t);let kr;const Dt=()=>kr||(kr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});var $={};function oe(e,...t){console.warn(`[Vue warn] ${e}`,...t)}let S;const Qt=new WeakSet;class hs{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Qt.has(this)&&(Qt.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Or(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ar(this),Ir(this);const t=S,r=Y;S=this,Y=!0;try{return this.fn()}finally{$.NODE_ENV!=="production"&&S!==this&&oe("Active effect was not restored correctly - this is likely a Vue internal bug."),Cr(this),S=t,Y=r,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)tr(t);this.deps=this.depsTail=void 0,Ar(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Qt.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){er(this)&&this.run()}get dirty(){return er(this)}}let Pr=0,it,ot;function Or(e,t=!1){if(e.flags|=8,t){e.next=ot,ot=e;return}e.next=it,it=e}function Xt(){Pr++}function Zt(){if(--Pr>0)return;if(ot){let t=ot;for(ot=void 0;t;){const r=t.next;t.next=void 0,t.flags&=-9,t=r}}let e;for(;it;){let t=it;for(it=void 0;t;){const r=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(n){e||(e=n)}t=r}}if(e)throw e}function Ir(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Cr(e){let t,r=e.depsTail,n=r;for(;n;){const s=n.prevDep;n.version===-1?(n===r&&(r=s),tr(n),ps(n)):t=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=s}e.deps=t,e.depsTail=r}function er(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(Mr(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function Mr(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===at))return;e.globalVersion=at;const t=e.dep;if(e.flags|=2,t.version>0&&!e.isSSR&&e.deps&&!er(e)){e.flags&=-3;return}const r=S,n=Y;S=e,Y=!0;try{Ir(e);const s=e.fn(e._value);(t.version===0||ke(s,e._value))&&(e._value=s,t.version++)}catch(s){throw t.version++,s}finally{S=r,Y=n,Cr(e),e.flags&=-3}}function tr(e,t=!1){const{dep:r,prevSub:n,nextSub:s}=e;if(n&&(n.nextSub=s,e.prevSub=void 0),s&&(s.prevSub=n,e.nextSub=void 0),$.NODE_ENV!=="production"&&r.subsHead===e&&(r.subsHead=s),r.subs===e&&(r.subs=n,!n&&r.computed)){r.computed.flags&=-5;for(let i=r.computed.deps;i;i=i.nextDep)tr(i,!0)}!t&&!--r.sc&&r.map&&r.map.delete(r.key)}function ps(e){const{prevDep:t,nextDep:r}=e;t&&(t.nextDep=r,e.prevDep=void 0),r&&(r.prevDep=t,e.nextDep=void 0)}let Y=!0;const jr=[];function Tt(){jr.push(Y),Y=!1}function Rt(){const e=jr.pop();Y=e===void 0?!0:e}function Ar(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const r=S;S=void 0;try{t()}finally{S=r}}}let at=0;class gs{constructor(t,r){this.sub=t,this.dep=r,this.version=r.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class rr{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,$.NODE_ENV!=="production"&&(this.subsHead=void 0)}track(t){if(!S||!Y||S===this.computed)return;let r=this.activeLink;if(r===void 0||r.sub!==S)r=this.activeLink=new gs(S,this),S.deps?(r.prevDep=S.depsTail,S.depsTail.nextDep=r,S.depsTail=r):S.deps=S.depsTail=r,Br(r);else if(r.version===-1&&(r.version=this.version,r.nextDep)){const n=r.nextDep;n.prevDep=r.prevDep,r.prevDep&&(r.prevDep.nextDep=n),r.prevDep=S.depsTail,r.nextDep=void 0,S.depsTail.nextDep=r,S.depsTail=r,S.deps===r&&(S.deps=n)}return $.NODE_ENV!=="production"&&S.onTrack&&S.onTrack(Fe({effect:S},t)),r}trigger(t){this.version++,at++,this.notify(t)}notify(t){Xt();try{if($.NODE_ENV!=="production")for(let r=this.subsHead;r;r=r.nextSub)r.sub.onTrigger&&!(r.sub.flags&8)&&r.sub.onTrigger(Fe({effect:r.sub},t));for(let r=this.subs;r;r=r.prevSub)r.sub.notify()&&r.sub.dep.notify()}finally{Zt()}}}function Br(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let n=t.deps;n;n=n.nextDep)Br(n)}const r=e.dep.subs;r!==e&&(e.prevSub=r,r&&(r.nextSub=e)),$.NODE_ENV!=="production"&&e.dep.subsHead===void 0&&(e.dep.subsHead=e),e.dep.subs=e}}const nr=new WeakMap,Pe=Symbol($.NODE_ENV!=="production"?"Object iterate":""),sr=Symbol($.NODE_ENV!=="production"?"Map keys iterate":""),ct=Symbol($.NODE_ENV!=="production"?"Array iterate":"");function B(e,t,r){if(Y&&S){let n=nr.get(e);n||nr.set(e,n=new Map);let s=n.get(r);s||(n.set(r,s=new rr),s.map=n,s.key=r),$.NODE_ENV!=="production"?s.track({target:e,type:t,key:r}):s.track()}}function _e(e,t,r,n,s,i){const o=nr.get(e);if(!o){at++;return}const a=c=>{c&&($.NODE_ENV!=="production"?c.trigger({target:e,type:t,key:r,newValue:n,oldValue:s,oldTarget:i}):c.trigger())};if(Xt(),t==="clear")o.forEach(a);else{const c=U(e),u=c&&Yt(r);if(c&&r==="length"){const d=Number(n);o.forEach((f,h)=>{(h==="length"||h===ct||!st(h)&&h>=d)&&a(f)})}else switch((r!==void 0||o.has(void 0))&&a(o.get(r)),u&&a(o.get(ct)),t){case"add":c?u&&a(o.get("length")):(a(o.get(Pe)),We(e)&&a(o.get(sr)));break;case"delete":c||(a(o.get(Pe)),We(e)&&a(o.get(sr)));break;case"set":We(e)&&a(o.get(Pe));break}}Zt()}function qe(e){const t=N(e);return t===e?t:(B(t,"iterate",ct),W(e)?t:t.map(q))}function ir(e){return B(e=N(e),"iterate",ct),e}const ws={__proto__:null,[Symbol.iterator](){return or(this,Symbol.iterator,q)},concat(...e){return qe(this).concat(...e.map(t=>U(t)?qe(t):t))},entries(){return or(this,"entries",e=>(e[1]=q(e[1]),e))},every(e,t){return ae(this,"every",e,t,void 0,arguments)},filter(e,t){return ae(this,"filter",e,t,r=>r.map(q),arguments)},find(e,t){return ae(this,"find",e,t,q,arguments)},findIndex(e,t){return ae(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return ae(this,"findLast",e,t,q,arguments)},findLastIndex(e,t){return ae(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return ae(this,"forEach",e,t,void 0,arguments)},includes(...e){return ar(this,"includes",e)},indexOf(...e){return ar(this,"indexOf",e)},join(e){return qe(this).join(e)},lastIndexOf(...e){return ar(this,"lastIndexOf",e)},map(e,t){return ae(this,"map",e,t,void 0,arguments)},pop(){return lt(this,"pop")},push(...e){return lt(this,"push",e)},reduce(e,...t){return Hr(this,"reduce",e,t)},reduceRight(e,...t){return Hr(this,"reduceRight",e,t)},shift(){return lt(this,"shift")},some(e,t){return ae(this,"some",e,t,void 0,arguments)},splice(...e){return lt(this,"splice",e)},toReversed(){return qe(this).toReversed()},toSorted(e){return qe(this).toSorted(e)},toSpliced(...e){return qe(this).toSpliced(...e)},unshift(...e){return lt(this,"unshift",e)},values(){return or(this,"values",q)}};function or(e,t,r){const n=ir(e),s=n[t]();return n!==e&&!W(e)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.value&&(i.value=r(i.value)),i}),s}const ms=Array.prototype;function ae(e,t,r,n,s,i){const o=ir(e),a=o!==e&&!W(e),c=o[t];if(c!==ms[t]){const f=c.apply(e,i);return a?q(f):f}let u=r;o!==e&&(a?u=function(f,h){return r.call(this,q(f),h,e)}:r.length>2&&(u=function(f,h){return r.call(this,f,h,e)}));const d=c.call(o,u,n);return a&&s?s(d):d}function Hr(e,t,r,n){const s=ir(e);let i=r;return s!==e&&(W(e)?r.length>3&&(i=function(o,a,c){return r.call(this,o,a,c,e)}):i=function(o,a,c){return r.call(this,o,q(a),c,e)}),s[t](i,...n)}function ar(e,t,r){const n=N(e);B(n,"iterate",ct);const s=n[t](...r);return(s===-1||s===!1)&&Os(r[0])?(r[0]=N(r[0]),n[t](...r)):s}function lt(e,t,r=[]){Tt(),Xt();const n=N(e)[t].apply(e,r);return Zt(),Rt(),n}const vs=Jt("__proto__,__v_isRef,__isVue"),Lr=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(st));function ys(e){st(e)||(e=String(e));const t=N(this);return B(t,"has",e),t.hasOwnProperty(e)}class Vr{constructor(t=!1,r=!1){this._isReadonly=t,this._isShallow=r}get(t,r,n){if(r==="__v_skip")return t.__v_skip;const s=this._isReadonly,i=this._isShallow;if(r==="__v_isReactive")return!s;if(r==="__v_isReadonly")return s;if(r==="__v_isShallow")return i;if(r==="__v_raw")return n===(s?i?Rs:Kr:i?Ts:qr).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(n)?t:void 0;const o=U(t);if(!s){let c;if(o&&(c=ws[r]))return c;if(r==="hasOwnProperty")return ys}const a=Reflect.get(t,r,re(t)?t:n);return(st(r)?Lr.has(r):vs(r))||(s||B(t,"get",r),i)?a:re(a)?o&&Yt(r)?a:a.value:ie(a)?s?Ur(a):lr(a):a}}class _s extends Vr{constructor(t=!1){super(!1,t)}set(t,r,n,s){let i=t[r];if(!this._isShallow){const c=be(i);if(!W(n)&&!be(n)&&(i=N(i),n=N(n)),!U(t)&&re(i)&&!re(n))return c?!1:(i.value=n,!0)}const o=U(t)&&Yt(r)?Number(r)<t.length:Gt(t,r),a=Reflect.set(t,r,n,re(t)?t:s);return t===N(s)&&(o?ke(n,i)&&_e(t,"set",r,n,i):_e(t,"add",r,n)),a}deleteProperty(t,r){const n=Gt(t,r),s=t[r],i=Reflect.deleteProperty(t,r);return i&&n&&_e(t,"delete",r,void 0,s),i}has(t,r){const n=Reflect.has(t,r);return(!st(r)||!Lr.has(r))&&B(t,"has",r),n}ownKeys(t){return B(t,"iterate",U(t)?"length":Pe),Reflect.ownKeys(t)}}class bs extends Vr{constructor(t=!1){super(!0,t)}set(t,r){return $.NODE_ENV!=="production"&&oe(`Set operation on key "${String(r)}" failed: target is readonly.`,t),!0}deleteProperty(t,r){return $.NODE_ENV!=="production"&&oe(`Delete operation on key "${String(r)}" failed: target is readonly.`,t),!0}}const Es=new _s,xs=new bs,cr=e=>e,kt=e=>Reflect.getPrototypeOf(e);function Ns(e,t,r){return function(...n){const s=this.__v_raw,i=N(s),o=We(i),a=e==="entries"||e===Symbol.iterator&&o,c=e==="keys"&&o,u=s[e](...n),d=r?cr:t?ur:q;return!t&&B(i,"iterate",c?sr:Pe),{next(){const{value:f,done:h}=u.next();return h?{value:f,done:h}:{value:a?[d(f[0]),d(f[1])]:d(f),done:h}},[Symbol.iterator](){return this}}}}function Pt(e){return function(...t){if($.NODE_ENV!=="production"){const r=t[0]?`on key "${t[0]}" `:"";oe(`${ds(e)} operation ${r}failed: target is readonly.`,N(this))}return e==="delete"?!1:e==="clear"?void 0:this}}function Ss(e,t){const r={get(s){const i=this.__v_raw,o=N(i),a=N(s);e||(ke(s,a)&&B(o,"get",s),B(o,"get",a));const{has:c}=kt(o),u=t?cr:e?ur:q;if(c.call(o,s))return u(i.get(s));if(c.call(o,a))return u(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!e&&B(N(s),"iterate",Pe),Reflect.get(s,"size",s)},has(s){const i=this.__v_raw,o=N(i),a=N(s);return e||(ke(s,a)&&B(o,"has",s),B(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,c=N(a),u=t?cr:e?ur:q;return!e&&B(c,"iterate",Pe),a.forEach((d,f)=>s.call(i,u(d),u(f),o))}};return Fe(r,e?{add:Pt("add"),set:Pt("set"),delete:Pt("delete"),clear:Pt("clear")}:{add(s){!t&&!W(s)&&!be(s)&&(s=N(s));const i=N(this);return kt(i).has.call(i,s)||(i.add(s),_e(i,"add",s,s)),this},set(s,i){!t&&!W(i)&&!be(i)&&(i=N(i));const o=N(this),{has:a,get:c}=kt(o);let u=a.call(o,s);u?$.NODE_ENV!=="production"&&Wr(o,a,s):(s=N(s),u=a.call(o,s));const d=c.call(o,s);return o.set(s,i),u?ke(i,d)&&_e(o,"set",s,i,d):_e(o,"add",s,i),this},delete(s){const i=N(this),{has:o,get:a}=kt(i);let c=o.call(i,s);c?$.NODE_ENV!=="production"&&Wr(i,o,s):(s=N(s),c=o.call(i,s));const u=a?a.call(i,s):void 0,d=i.delete(s);return c&&_e(i,"delete",s,void 0,u),d},clear(){const s=N(this),i=s.size!==0,o=$.NODE_ENV!=="production"?We(s)?new Map(s):new Set(s):void 0,a=s.clear();return i&&_e(s,"clear",void 0,void 0,o),a}}),["keys","values","entries",Symbol.iterator].forEach(s=>{r[s]=Ns(s,e,t)}),r}function Fr(e,t){const r=Ss(e,t);return(n,s,i)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?n:Reflect.get(Gt(r,s)&&s in n?r:n,s,i)}const $s={get:Fr(!1,!1)},Ds={get:Fr(!0,!1)};function Wr(e,t,r){const n=N(r);if(n!==r&&t.call(e,n)){const s=Rr(e);oe(`Reactive ${s} contains both the raw and reactive versions of the same object${s==="Map"?" as keys":""}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}const qr=new WeakMap,Ts=new WeakMap,Kr=new WeakMap,Rs=new WeakMap;function ks(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Ps(e){return e.__v_skip||!Object.isExtensible(e)?0:ks(Rr(e))}function lr(e){return be(e)?e:zr(e,!1,Es,$s,qr)}function Ur(e){return zr(e,!0,xs,Ds,Kr)}function zr(e,t,r,n,s){if(!ie(e))return $.NODE_ENV!=="production"&&oe(`value cannot be made ${t?"readonly":"reactive"}: ${String(e)}`),e;if(e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=s.get(e);if(i)return i;const o=Ps(e);if(o===0)return e;const a=new Proxy(e,o===2?n:r);return s.set(e,a),a}function ut(e){return be(e)?ut(e.__v_raw):!!(e&&e.__v_isReactive)}function be(e){return!!(e&&e.__v_isReadonly)}function W(e){return!!(e&&e.__v_isShallow)}function Os(e){return e?!!e.__v_raw:!1}function N(e){const t=e&&e.__v_raw;return t?N(t):e}const q=e=>ie(e)?lr(e):e,ur=e=>ie(e)?Ur(e):e;function re(e){return e?e.__v_isRef===!0:!1}class Is{constructor(t){this.__v_isRef=!0,this._value=void 0;const r=this.dep=new rr,{get:n,set:s}=t(r.track.bind(r),r.trigger.bind(r));this._get=n,this._set=s}get value(){return this._value=this._get()}set value(t){this._set(t)}}function Cs(e){return new Is(e)}class Ms{constructor(t,r,n){this.fn=t,this.setter=r,this._value=void 0,this.dep=new rr(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=at-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!r,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&S!==this)return Or(this,!0),!0}get value(){const t=$.NODE_ENV!=="production"?this.dep.track({target:this,type:"get",key:"value"}):this.dep.track();return Mr(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter?this.setter(t):$.NODE_ENV!=="production"&&oe("Write operation failed: computed value is readonly")}}function js(e,t,r=!1){let n,s;return F(e)?n=e:(n=e.get,s=e.set),new Ms(n,s,r)}const Ot={},It=new WeakMap;let Oe;function As(e,t=!1,r=Oe){if(r){let n=It.get(r);n||It.set(r,n=[]),n.push(e)}else $.NODE_ENV!=="production"&&!t&&oe("onWatcherCleanup() was called when there was no active watcher to associate with.")}function Bs(e,t,r=rt){const{immediate:n,deep:s,once:i,scheduler:o,augmentJob:a,call:c}=r,u=m=>{(r.onWarn||oe)("Invalid watch source: ",m,"A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.")},d=m=>s?m:W(m)||s===!1||s===0?Ee(m,1):Ee(m);let f,h,p,x,b=!1,I=!1;if(re(e)?(h=()=>e.value,b=W(e)):ut(e)?(h=()=>d(e),b=!0):U(e)?(I=!0,b=e.some(m=>ut(m)||W(m)),h=()=>e.map(m=>{if(re(m))return m.value;if(ut(m))return d(m);if(F(m))return c?c(m,2):m();$.NODE_ENV!=="production"&&u(m)})):F(e)?t?h=c?()=>c(e,2):e:h=()=>{if(p){Tt();try{p()}finally{Rt()}}const m=Oe;Oe=f;try{return c?c(e,3,[x]):e(x)}finally{Oe=m}}:(h=nt,$.NODE_ENV!=="production"&&u(e)),t&&s){const m=h,V=s===!0?1/0:s;h=()=>Ee(m(),V)}const C=()=>{f.stop()};if(i&&t){const m=t;t=(...V)=>{m(...V),C()}}let L=I?new Array(e.length).fill(Ot):Ot;const te=m=>{if(!(!(f.flags&1)||!f.dirty&&!m))if(t){const V=f.run();if(s||b||(I?V.some((tt,ve)=>ke(tt,L[ve])):ke(V,L))){p&&p();const tt=Oe;Oe=f;try{const ve=[V,L===Ot?void 0:I&&L[0]===Ot?[]:L,x];c?c(t,3,ve):t(...ve),L=V}finally{Oe=tt}}}else f.run()};return a&&a(te),f=new hs(h),f.scheduler=o?()=>o(te,!1):te,x=m=>As(m,!1,f),p=f.onStop=()=>{const m=It.get(f);if(m){if(c)c(m,4);else for(const V of m)V();It.delete(f)}},$.NODE_ENV!=="production"&&(f.onTrack=r.onTrack,f.onTrigger=r.onTrigger),t?n?te(!0):L=f.run():o?o(te.bind(null,!0),!0):f.run(),C.pause=f.pause.bind(f),C.resume=f.resume.bind(f),C.stop=C,C}function Ee(e,t=1/0,r){if(t<=0||!ie(e)||e.__v_skip||(r=r||new Set,r.has(e)))return e;if(r.add(e),t--,re(e))Ee(e.value,t,r);else if(U(e))for(let n=0;n<e.length;n++)Ee(e[n],t,r);else if(cs(e)||We(e))e.forEach(n=>{Ee(n,t,r)});else if(fs(e)){for(const n in e)Ee(e[n],t,r);for(const n of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,n)&&Ee(e[n],t,r)}return e}var M={};const Ie=[];function Hs(e){Ie.push(e)}function Ls(){Ie.pop()}let fr=!1;function Q(e,...t){if(fr)return;fr=!0,Tt();const r=Ie.length?Ie[Ie.length-1].component:null,n=r&&r.appContext.config.warnHandler,s=Vs();if(n)Ct(n,r,11,[e+t.map(i=>{var o,a;return(a=(o=i.toString)==null?void 0:o.call(i))!=null?a:JSON.stringify(i)}).join(""),r&&r.proxy,s.map(({vnode:i})=>`at <${ln(r,i.type)}>`).join(`
`),s]);else{const i=[`[Vue warn]: ${e}`,...t];s.length&&i.push(`
`,...Fs(s)),console.warn(...i)}Rt(),fr=!1}function Vs(){let e=Ie[Ie.length-1];if(!e)return[];const t=[];for(;e;){const r=t[0];r&&r.vnode===e?r.recurseCount++:t.push({vnode:e,recurseCount:0});const n=e.component&&e.component.parent;e=n&&n.vnode}return t}function Fs(e){const t=[];return e.forEach((r,n)=>{t.push(...n===0?[]:[`
`],...Ws(r))}),t}function Ws({vnode:e,recurseCount:t}){const r=t>0?`... (${t} recursive calls)`:"",n=e.component?e.component.parent==null:!1,s=` at <${ln(e.component,e.type,n)}`,i=">"+r;return e.props?[s,...qs(e.props),i]:[s+i]}function qs(e){const t=[],r=Object.keys(e);return r.slice(0,3).forEach(n=>{t.push(...Jr(n,e[n]))}),r.length>3&&t.push(" ..."),t}function Jr(e,t,r){return Tr(t)?(t=JSON.stringify(t),r?t:[`${e}=${t}`]):typeof t=="number"||typeof t=="boolean"||t==null?r?t:[`${e}=${t}`]:re(t)?(t=Jr(e,N(t.value),!0),r?t:[`${e}=Ref<`,t,">"]):F(t)?[`${e}=fn${t.name?`<${t.name}>`:""}`]:(t=N(t),r?t:[`${e}=`,t])}const Gr={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",0:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush",15:"component update",16:"app unmount cleanup function"};function Ct(e,t,r,n){try{return n?e(...n):e()}catch(s){dr(s,t,r)}}function Yr(e,t,r,n){if(F(e)){const s=Ct(e,t,r,n);return s&&ls(s)&&s.catch(i=>{dr(i,t,r)}),s}if(U(e)){const s=[];for(let i=0;i<e.length;i++)s.push(Yr(e[i],t,r,n));return s}else M.NODE_ENV!=="production"&&Q(`Invalid value type passed to callWithAsyncErrorHandling(): ${typeof e}`)}function dr(e,t,r,n=!0){const s=t?t.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=t&&t.appContext.config||rt;if(t){let a=t.parent;const c=t.proxy,u=M.NODE_ENV!=="production"?Gr[r]:`https://vuejs.org/error-reference/#runtime-${r}`;for(;a;){const d=a.ec;if(d){for(let f=0;f<d.length;f++)if(d[f](e,c,u)===!1)return}a=a.parent}if(i){Tt(),Ct(i,null,10,[e,c,u]),Rt();return}}Ks(e,r,s,n,o)}function Ks(e,t,r,n=!0,s=!1){if(M.NODE_ENV!=="production"){const i=Gr[t];if(r&&Hs(r),Q(`Unhandled error${i?` during execution of ${i}`:""}`),r&&Ls(),n)throw e;console.error(e)}else{if(s)throw e;console.error(e)}}const z=[];let ce=-1;const Ke=[];let xe=null,Ue=0;const Qr=Promise.resolve();let Mt=null;const Us=100;function Xr(e){const t=Mt||Qr;return e?t.then(this?e.bind(this):e):t}function zs(e){let t=ce+1,r=z.length;for(;t<r;){const n=t+r>>>1,s=z[n],i=ft(s);i<e||i===e&&s.flags&2?t=n+1:r=n}return t}function Zr(e){if(!(e.flags&1)){const t=ft(e),r=z[z.length-1];!r||!(e.flags&2)&&t>=ft(r)?z.push(e):z.splice(zs(t),0,e),e.flags|=1,en()}}function en(){Mt||(Mt=Qr.then(rn))}function tn(e){U(e)?Ke.push(...e):xe&&e.id===-1?xe.splice(Ue+1,0,e):e.flags&1||(Ke.push(e),e.flags|=1),en()}function Js(e){if(Ke.length){const t=[...new Set(Ke)].sort((r,n)=>ft(r)-ft(n));if(Ke.length=0,xe){xe.push(...t);return}for(xe=t,M.NODE_ENV!=="production"&&(e=e||new Map),Ue=0;Ue<xe.length;Ue++){const r=xe[Ue];M.NODE_ENV!=="production"&&nn(e,r)||(r.flags&4&&(r.flags&=-2),r.flags&8||r(),r.flags&=-2)}xe=null,Ue=0}}const ft=e=>e.id==null?e.flags&2?-1:1/0:e.id;function rn(e){M.NODE_ENV!=="production"&&(e=e||new Map);const t=M.NODE_ENV!=="production"?r=>nn(e,r):nt;try{for(ce=0;ce<z.length;ce++){const r=z[ce];if(r&&!(r.flags&8)){if(M.NODE_ENV!=="production"&&t(r))continue;r.flags&4&&(r.flags&=-2),Ct(r,r.i,r.i?15:14),r.flags&4||(r.flags&=-2)}}}finally{for(;ce<z.length;ce++){const r=z[ce];r&&(r.flags&=-2)}ce=-1,z.length=0,Js(e),Mt=null,(z.length||Ke.length)&&rn(e)}}function nn(e,t){const r=e.get(t)||0;if(r>Us){const n=t.i,s=n&&cn(n.type);return dr(`Maximum recursive updates exceeded${s?` in component <${s}>`:""}. This means you have a reactive effect that is mutating its own dependencies and thus recursively triggering itself. Possible sources include component template, render function, updated hook or watcher source function.`,null,10),!0}return e.set(t,r+1),!1}const hr=new Map;M.NODE_ENV!=="production"&&(Dt().__VUE_HMR_RUNTIME__={createRecord:pr(Gs),rerender:pr(Ys),reload:pr(Qs)});const jt=new Map;function Gs(e,t){return jt.has(e)?!1:(jt.set(e,{initialDef:At(t),instances:new Set}),!0)}function At(e){return li(e)?e.__vccOpts:e}function Ys(e,t){const r=jt.get(e);r&&(r.initialDef.render=t,[...r.instances].forEach(n=>{t&&(n.render=t,At(n.type).render=t),n.renderCache=[],n.update()}))}function Qs(e,t){const r=jt.get(e);if(!r)return;t=At(t),sn(r.initialDef,t);const n=[...r.instances];for(let s=0;s<n.length;s++){const i=n[s],o=At(i.type);let a=hr.get(o);a||(o!==r.initialDef&&sn(o,t),hr.set(o,a=new Set)),a.add(i),i.appContext.propsCache.delete(i.type),i.appContext.emitsCache.delete(i.type),i.appContext.optionsCache.delete(i.type),i.ceReload?(a.add(i),i.ceReload(t.styles),a.delete(i)):i.parent?Zr(()=>{i.parent.update(),a.delete(i)}):i.appContext.reload?i.appContext.reload():typeof window<"u"?window.location.reload():console.warn("[HMR] Root or manually mounted instance modified. Full reload required."),i.root.ce&&i!==i.root&&i.root.ce._removeChildStyle(o)}tn(()=>{hr.clear()})}function sn(e,t){Fe(e,t);for(const r in e)r!=="__file"&&!(r in t)&&delete e[r]}function pr(e){return(t,r)=>{try{return e(t,r)}catch(n){console.error(n),console.warn("[HMR] Something went wrong during Vue component hot-reload. Full reload required.")}}}let on=null;Dt().requestIdleCallback,Dt().cancelIdleCallback;const Xs={};M.NODE_ENV!=="production"&&(Xs.ownKeys=e=>(Q("Avoid app logic that relies on enumerating keys on a component instance. The keys will be empty in production mode to avoid performance overhead."),Reflect.ownKeys(e)));let Zs=null;function ei(e,t,r=!1){const n=Bt||on;if(n||Zs){const s=n?n.parent==null?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&e in s)return s[e];if(arguments.length>1)return r&&F(t)?t.call(n&&n.proxy):t;M.NODE_ENV!=="production"&&Q(`injection "${String(e)}" not found.`)}else M.NODE_ENV!=="production"&&Q("inject() can only be used inside setup() or functional components.")}const ti=ii,ri=Symbol.for("v-scx"),ni=()=>{{const e=ei(ri);return e||M.NODE_ENV!=="production"&&Q("Server rendering context not provided. Make sure to only call useSSRContext() conditionally in the server build."),e}};function si(e,t){return an(e,null,t)}function gr(e,t,r){return M.NODE_ENV!=="production"&&!F(t)&&Q("`watch(fn, options?)` signature has been moved to a separate API. Use `watchEffect(fn, options?)` instead. `watch` now only supports `watch(source, cb, options?) signature."),an(e,t,r)}function an(e,t,r=rt){const{immediate:n,deep:s,flush:i,once:o}=r;M.NODE_ENV!=="production"&&!t&&(n!==void 0&&Q('watch() "immediate" option is only respected when using the watch(source, callback, options?) signature.'),s!==void 0&&Q('watch() "deep" option is only respected when using the watch(source, callback, options?) signature.'),o!==void 0&&Q('watch() "once" option is only respected when using the watch(source, callback, options?) signature.'));const a=Fe({},r);M.NODE_ENV!=="production"&&(a.onWarn=Q);const c=t&&n||!t&&i!=="post";let u;if(Ht){if(i==="sync"){const p=ni();u=p.__watcherHandles||(p.__watcherHandles=[])}else if(!c){const p=()=>{};return p.stop=nt,p.resume=nt,p.pause=nt,p}}const d=Bt;a.call=(p,x,b)=>Yr(p,d,x,b);let f=!1;i==="post"?a.scheduler=p=>{ti(p,d&&d.suspense)}:i!=="sync"&&(f=!0,a.scheduler=(p,x)=>{x?p():Zr(p)}),a.augmentJob=p=>{t&&(p.flags|=4),f&&(p.flags|=2,d&&(p.id=d.uid,p.i=d))};const h=Bs(e,t,a);return Ht&&(u?u.push(h):c&&h()),h}function ii(e,t){t&&t.pendingBranch?U(e)?t.effects.push(...e):t.effects.push(e):tn(e)}let Bt=null;const oi=()=>Bt||on;{const e=Dt(),t=(r,n)=>{let s;return(s=e[r])||(s=e[r]=[]),s.push(n),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};t("__VUE_INSTANCE_SETTERS__",r=>Bt=r),t("__VUE_SSR_SETTERS__",r=>Ht=r)}let Ht=!1;const ai=/(?:^|[-_])(\w)/g,ci=e=>e.replace(ai,t=>t.toUpperCase()).replace(/[-_]/g,"");function cn(e,t=!0){return F(e)?e.displayName||e.name:e.name||t&&e.__name}function ln(e,t,r=!1){let n=cn(t);if(!n&&t.__file){const s=t.__file.match(/([^/\\]+)\.\w+$/);s&&(n=s[1])}if(!n&&e&&e.parent){const s=i=>{for(const o in i)if(i[o]===t)return o};n=s(e.components||e.parent.type.components)||s(e.appContext.components)}return n?ci(n):r?"App":"Anonymous"}function li(e){return F(e)&&"__vccOpts"in e}const ui=(e,t)=>{const r=js(e,t,Ht);if(M.NODE_ENV!=="production"){const n=oi();n&&n.appContext.config.warnRecursiveComputed&&(r._warnRecursive=!0)}return r};function fi(){if(M.NODE_ENV==="production"||typeof window>"u")return;const e={style:"color:#3ba776"},t={style:"color:#1677ff"},r={style:"color:#f5222d"},n={style:"color:#eb2f96"},s={__vue_custom_formatter:!0,header(f){return ie(f)?f.__isVue?["div",e,"VueInstance"]:re(f)?["div",{},["span",e,d(f)],"<",a("_value"in f?f._value:f),">"]:ut(f)?["div",{},["span",e,W(f)?"ShallowReactive":"Reactive"],"<",a(f),`>${be(f)?" (readonly)":""}`]:be(f)?["div",{},["span",e,W(f)?"ShallowReadonly":"Readonly"],"<",a(f),">"]:null:null},hasBody(f){return f&&f.__isVue},body(f){if(f&&f.__isVue)return["div",{},...i(f.$)]}};function i(f){const h=[];f.type.props&&f.props&&h.push(o("props",N(f.props))),f.setupState!==rt&&h.push(o("setup",f.setupState)),f.data!==rt&&h.push(o("data",N(f.data)));const p=c(f,"computed");p&&h.push(o("computed",p));const x=c(f,"inject");return x&&h.push(o("injected",x)),h.push(["div",{},["span",{style:n.style+";opacity:0.66"},"$ (internal): "],["object",{object:f}]]),h}function o(f,h){return h=Fe({},h),Object.keys(h).length?["div",{style:"line-height:1.25em;margin-bottom:0.6em"},["div",{style:"color:#476582"},f],["div",{style:"padding-left:1.25em"},...Object.keys(h).map(p=>["div",{},["span",n,p+": "],a(h[p],!1)])]]:["span",{}]}function a(f,h=!0){return typeof f=="number"?["span",t,f]:typeof f=="string"?["span",r,JSON.stringify(f)]:typeof f=="boolean"?["span",n,f]:ie(f)?["object",{object:h?N(f):f}]:["span",r,String(f)]}function c(f,h){const p=f.type;if(F(p))return;const x={};for(const b in f.ctx)u(p,b,h)&&(x[b]=f.ctx[b]);return x}function u(f,h,p){const x=f[p];if(U(x)&&x.includes(h)||ie(x)&&h in x||f.extends&&u(f.extends,h,p)||f.mixins&&f.mixins.some(b=>u(b,h,p)))return!0}function d(f){return W(f)?"ShallowRef":f.effect?"ComputedRef":"Ref"}window.devtoolsFormatters?window.devtoolsFormatters.push(s):window.devtoolsFormatters=[s]}var di={};function hi(){fi()}di.NODE_ENV!=="production"&&hi();class pi{constructor(){g(this,"pending",!1);g(this,"fulfilled",!1);g(this,"rejected",!1);g(this,"data",{});g(this,"error",{});g(this,"_p",Promise.resolve())}setP(t){this._p=t}equalP(t){return this._p===t}reLoad(){}setValue(t){}}const gi=Symbol();function wr({deps:e,getter:t,dataMergeFun:r=(s,i)=>i,defaultData:n}){const s=new pi;return n!==void 0&&(s.data=n),Cs((i,o)=>{if(!e&&t)si(()=>a(t()));else if(e&&t)if(e instanceof Function){const c=e();Array.isArray(c)&&c.length===0||gr(e,()=>a(t()),{immediate:!0})}else gr(e,()=>a(t()),{immediate:!0});function a(c){if(s.pending=!0,s.fulfilled=!1,s.rejected=!1,c===gi){Xr(o);return}s.setP(c),Xr(o),c.then(u=>{s.equalP(c)&&(s.pending=!1,s.fulfilled=!0,s.data=r(s.data,u))}).catch(u=>{s.equalP(c)&&(s.pending=!1,s.rejected=!0,s.error=u)}).finally(()=>{s.equalP(c)&&o()})}return s.reLoad=()=>{t&&a(t())},s.setValue=c=>{s.pending=!1,s.fulfilled=!0,s.data=r(s.data,c),o()},{get(){return i(),s},set(c){console.warn("不可设置值")}}})}(e=>{function t(n){return e({deps:()=>[],getter:n})}e.nullDeps=t;function r(n){return e({getter(){return n()}})}e.fn=r})(wr||(wr={}));function dt(e,t,r={add:!0,update:!0}){for(let n in t)t.hasOwnProperty(n)&&(t[n]instanceof Object&&!Array.isArray(t[n])?(e.hasOwnProperty(n)||(e[n]={}),dt(e[n],t[n],r)):(!e.hasOwnProperty(n)&&r.add||r.update)&&(e[n]=t[n]));return e}const wi={version:"1.0.0"}.version,un={name:"default",notebook:{},authorized:"",apiPrefix:"http://127.0.0.1:6806",compressedZip:!0,withoutPublicZip:!0,excludeAssetsCopy:!1,sitemap:{enable:!0,sitePrefix:".",siteLink:"",description:"",title:"",rss:!0},enableIncrementalCompilation:!1,enableIncrementalCompilation_doc:!0,__skipBuilds__:{},cdn:{siyuanPrefix:"https://fastly.jsdelivr.net/gh/siyuan-note/oceanpress@v0.0.7/apps/frontend/public/notebook/",publicZip:"https://fastly.jsdelivr.net/gh/siyuan-note/oceanpress@v0.0.7/apps/frontend/public/public.zip"},s3:{enable:!1,bucket:"",region:"",pathPrefix:"",endpoint:"",accessKeyId:"",secretAccessKey:""},oceanPressServer:{enable:!1,apiBase:"",apiKey:""},meilisearch:{enable:!1,host:"",apiKey:"",indexName:""},embedCode:{head:"",beforeBody:"",afterBody:`<footer>
<p style="text-align:center;margin:15px 0;">
  技术支持：
  <a target="_blank" href="https://github.com/2234839/oceanPress_js">OceanPress</a> |
  开发者：
  <a target="_blank" href="https://heartstack.space/user/%E5%AD%90%E8%99%9A/posts">崮生（子虚）</a>
</p>
</footer>`},OceanPress:{version:wi}},le=lr({__current__:"default",__init__:!0,default:dt({},un)}),fn=e=>{if(e)dt(le,e);else{const t=v.getItem("configs");t&&dt(le,JSON.parse(t))}Object.entries(le).filter(([t])=>t.startsWith("__")===!1).forEach(([t,r])=>{dt(r,un,{update:!1,add:!0})})},ze=ui(()=>le[le.__current__]),mi=()=>{le.__init__===!1&&v.setItem("configs",JSON.stringify(le,null,2))};let Lt=null;gr(le,()=>{Lt&&clearTimeout(Lt),Lt=setTimeout(()=>{mi(),Lt=null},700)},{deep:!0}),le.__init__=!1,globalThis.document&&fn();async function dn(e,t){const r=ze.value.apiPrefix,n=ze.value.authorized;if(e==="get_assets")return fetch(`${r}/${t[0].path}`,{headers:{Authorization:`Token ${n}`},body:null,method:"GET",mode:"cors"}).then(o=>o.arrayBuffer());const s=await fetch(`${r}/api/${e.replace(/_/g,"/")}`,{headers:{Authorization:`Token ${n}`},body:JSON.stringify(t[0]),method:"POST"}).catch(o=>{throw o.message="访问思源接口时出错了，请检查思源服务是否启动以及配置接口地址是否正确。",o});if(e==="file_getFile"){const o=t[0].path;if(o.endsWith(".sy"))return await s.json();{const a=await s.arrayBuffer();if(a.byteLength<200){const u=new TextDecoder().decode(a);if(JSON.parse(u).code===404)throw new Error(`文件不存在: ${o}`)}return a}}const i=await s.json();if(i.code!==0)throw new Error(i.msg);return i.data}const mr=new Proxy({},{get(e,t){return(...r)=>dn(t,r)}});new Proxy({},{get(e,t){return(...r)=>wr.fn(()=>dn(t,r))}});let ue=!0;function vi(e){ue=e}const vr=new Map,hn=new Map,pn=new Map,gn=new Map;async function wn(e){if(ue&&vr.has(e))return vr.get(e);const t=await mr.query_sql({stmt:e});return ue&&vr.set(e,t),t}async function mn(e){if(ue){const n=hn.get(e);if(n)return n}const t=(await wn(`SELECT * FROM blocks WHERE hpath = '${e}'`))[0];if(t===void 0)throw new Error(`not doc by:${e}`);const r=await yi(T(t));return ue&&hn.set(e,r),r}async function yi(e){const t=_n(await mr.file_getFile({path:e}));return ue&&yn(t),t}async function yr(e){if(ue){const r=gn.get(e);if(r)return r}const t=await wn(`
          SELECT * from blocks
          WHERE id = '${e}'
        `);if(t.length!==0)return ue&&gn.set(e,t[0]),t[0]}async function vn(e){if(ue){const r=pn.get(e);if(r){let n=r;for(;;){if(n.Type==="NodeDocument")return n;if(n===void 0)break;n=n.Parent}}}const t=await yr(e);if(t!==void 0)return await mn(t.hpath)}function yn(e){e.ID&&pn.set(e.ID,e),e.Children&&e.Children.forEach(yn)}function _n(e){for(const t of(e==null?void 0:e.Children)??[])t.Parent=e,_n(t);return e}v.getDocByChildID=async e=>await vn(e),v.getDocPathBySY=async e=>{if(e!=null&&e.ID){const t=await yr(e.ID);if(t)return T(t)}},v.getHPathByID_Node=async e=>{const t=typeof e=="string"?e:e.ID;if(t===void 0)throw new Error("id is undefined");if(await vn(t)===void 0)throw new Error("docNode is undefined");const n=await yr(t);if(n===void 0)throw new Error("docBlock is undefined");return n.hpath},v.getNodeByID=async e=>{if(e===void 0)return;const t=await v.getDocByChildID(e);if(t===void 0)return;return r(t);function r(n){if(n.ID===e)return n;if(n.Children!==void 0)for(const s of n.Children){const i=r(s);if(i)return i}}};var bn=(e,t,r)=>(n,s)=>{let i=-1;return o(0);async function o(a){if(a<=i)throw new Error("next() called multiple times");i=a;let c,u=!1,d;if(e[a]?(d=e[a][0][0],n.req.routeIndex=a):d=a===e.length&&s||void 0,d)try{c=await d(n,()=>o(a+1))}catch(f){if(f instanceof Error&&t)n.error=f,c=await t(f,n),u=!0;else throw f}else n.finalized===!1&&r&&(c=await r(n));return c&&(n.finalized===!1||u)&&(n.res=c),n}},_i=async(e,t=Object.create(null))=>{const{all:r=!1,dot:n=!1}=t,i=(e instanceof kn?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?bi(e,{all:r,dot:n}):{}};async function bi(e,t){const r=await e.formData();return r?Ei(r,t):{}}function Ei(e,t){const r=Object.create(null);return e.forEach((n,s)=>{t.all||s.endsWith("[]")?xi(r,s,n):r[s]=n}),t.dot&&Object.entries(r).forEach(([n,s])=>{n.includes(".")&&(Ni(r,n,s),delete r[n])}),r}var xi=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},Ni=(e,t,r)=>{let n=e;const s=t.split(".");s.forEach((i,o)=>{o===s.length-1?n[i]=r:((!n[i]||typeof n[i]!="object"||Array.isArray(n[i])||n[i]instanceof File)&&(n[i]=Object.create(null)),n=n[i])})},En=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},Si=e=>{const{groups:t,path:r}=$i(e),n=En(r);return Di(n,t)},$i=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,n)=>{const s=`@${n}`;return t.push([s,r]),s}),{groups:t,path:e}},Di=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[n]=t[r];for(let s=e.length-1;s>=0;s--)if(e[s].includes(n)){e[s]=e[s].replace(n,t[r][1]);break}}return e},Vt={},xn=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const n=`${e}#${t}`;return Vt[n]||(r[2]?Vt[n]=t&&t[0]!==":"&&t[0]!=="*"?[n,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Vt[n]=[e,r[1],!0]),Vt[n]}return null},Nn=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},Ti=e=>Nn(e,decodeURI),Sn=e=>{const t=e.url,r=t.indexOf("/",8);let n=r;for(;n<t.length;n++){const s=t.charCodeAt(n);if(s===37){const i=t.indexOf("?",n),o=t.slice(r,i===-1?void 0:i);return Ti(o.includes("%25")?o.replace(/%25/g,"%2525"):o)}else if(s===63)break}return t.slice(r,n)},Ri=e=>{const t=Sn(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},Je=(e,t,...r)=>(r.length&&(t=Je(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),$n=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let n="";return t.forEach(s=>{if(s!==""&&!/\:/.test(s))n+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){r.length===0&&n===""?r.push("/"):r.push(n);const i=s.replace("?","");n+="/"+i,r.push(n)}else n+="/"+s}),r.filter((s,i,o)=>o.indexOf(s)===i)},_r=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?Tn(e):e):e,Dn=(e,t,r)=>{let n;if(!r&&t&&!/[%+]/.test(t)){let o=e.indexOf(`?${t}`,8);for(o===-1&&(o=e.indexOf(`&${t}`,8));o!==-1;){const a=e.charCodeAt(o+t.length+1);if(a===61){const c=o+t.length+2,u=e.indexOf("&",c);return _r(e.slice(c,u===-1?void 0:u))}else if(a==38||isNaN(a))return"";o=e.indexOf(`&${t}`,o+1)}if(n=/[%+]/.test(e),!n)return}const s={};n??(n=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const o=e.indexOf("&",i+1);let a=e.indexOf("=",i);a>o&&o!==-1&&(a=-1);let c=e.slice(i+1,a===-1?o===-1?void 0:o:a);if(n&&(c=_r(c)),i=o,c==="")continue;let u;a===-1?u="":(u=e.slice(a+1,o===-1?void 0:o),n&&(u=_r(u))),r?(s[c]&&Array.isArray(s[c])||(s[c]=[]),s[c].push(u)):s[c]??(s[c]=u)}return t?s[t]:s},ki=Dn,Pi=(e,t)=>Dn(e,t,!0),Tn=decodeURIComponent,Rn=e=>Nn(e,Tn),kn=(Kn=class{constructor(e,t="/",r=[[]]){y(this,fe);g(this,"raw");y(this,Ye);y(this,X);g(this,"routeIndex",0);g(this,"path");g(this,"bodyCache",{});y(this,Ne,e=>{const{bodyCache:t,raw:r}=this,n=t[e];if(n)return n;const s=Object.keys(t)[0];return s?t[s].then(i=>(s==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,w(this,X,r),w(this,Ye,{})}param(e){return e?_(this,fe,rs).call(this,e):_(this,fe,ns).call(this)}query(e){return ki(this.url,e)}queries(e){return Pi(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,n)=>{t[n]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await _i(this,e))}json(){return l(this,Ne).call(this,"json")}text(){return l(this,Ne).call(this,"text")}arrayBuffer(){return l(this,Ne).call(this,"arrayBuffer")}blob(){return l(this,Ne).call(this,"blob")}formData(){return l(this,Ne).call(this,"formData")}addValidatedData(e,t){l(this,Ye)[e]=t}valid(e){return l(this,Ye)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return l(this,X)[0].map(([[,e]])=>e)}get routePath(){return l(this,X)[0].map(([[,e]])=>e)[this.routeIndex].path}},Ye=new WeakMap,X=new WeakMap,fe=new WeakSet,rs=function(e){const t=l(this,X)[0][this.routeIndex][1][e],r=_(this,fe,Dr).call(this,t);return r?/\%/.test(r)?Rn(r):r:void 0},ns=function(){const e={},t=Object.keys(l(this,X)[0][this.routeIndex][1]);for(const r of t){const n=_(this,fe,Dr).call(this,l(this,X)[0][this.routeIndex][1][r]);n&&typeof n=="string"&&(e[r]=/\%/.test(n)?Rn(n):n)}return e},Dr=function(e){return l(this,X)[1]?l(this,X)[1][e]:e},Ne=new WeakMap,Kn),Oi={Stringify:1},Pn=async(e,t,r,n,s)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(s?s[0]+=e:s=[e],Promise.all(i.map(a=>a({phase:t,buffer:s,context:n}))).then(a=>Promise.all(a.filter(Boolean).map(c=>Pn(c,t,!1,n,s))).then(()=>s[0]))):Promise.resolve(e)},Ii="text/plain; charset=UTF-8",br=(e,t={})=>{for(const r of Object.keys(t))e.set(r,t[r]);return e},Ci=(Un=class{constructor(e,t){y(this,H);y(this,_t);y(this,bt);g(this,"env",{});y(this,de);g(this,"finalized",!1);g(this,"error");y(this,Ce,200);y(this,he);y(this,D);y(this,R);y(this,se);y(this,pe,!0);y(this,Et);y(this,Qe);y(this,Xe);y(this,xt);y(this,Nt);g(this,"render",(...e)=>(l(this,Qe)??w(this,Qe,t=>this.html(t)),l(this,Qe).call(this,...e)));g(this,"setLayout",e=>w(this,Et,e));g(this,"getLayout",()=>l(this,Et));g(this,"setRenderer",e=>{w(this,Qe,e)});g(this,"header",(e,t,r)=>{if(t===void 0){l(this,D)?l(this,D).delete(e):l(this,R)&&delete l(this,R)[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}r!=null&&r.append?(l(this,D)||(w(this,pe,!1),w(this,D,new Headers(l(this,R))),w(this,R,{})),l(this,D).append(e,t)):l(this,D)?l(this,D).set(e,t):(l(this,R)??w(this,R,{}),l(this,R)[e.toLowerCase()]=t),this.finalized&&(r!=null&&r.append?this.res.headers.append(e,t):this.res.headers.set(e,t))});g(this,"status",e=>{w(this,pe,!1),w(this,Ce,e)});g(this,"set",(e,t)=>{l(this,de)??w(this,de,new Map),l(this,de).set(e,t)});g(this,"get",e=>l(this,de)?l(this,de).get(e):void 0);g(this,"newResponse",(...e)=>_(this,H,G).call(this,...e));g(this,"body",(e,t,r)=>typeof t=="number"?_(this,H,G).call(this,e,t,r):_(this,H,G).call(this,e,t));g(this,"text",(e,t,r)=>{if(!l(this,R)){if(l(this,pe)&&!r&&!t)return new Response(e);w(this,R,{})}return l(this,R)["content-type"]=Ii,typeof t=="number"?_(this,H,G).call(this,e,t,r):_(this,H,G).call(this,e,t)});g(this,"json",(e,t,r)=>{const n=JSON.stringify(e);return l(this,R)??w(this,R,{}),l(this,R)["content-type"]="application/json",typeof t=="number"?_(this,H,G).call(this,n,t,r):_(this,H,G).call(this,n,t)});g(this,"html",(e,t,r)=>(l(this,R)??w(this,R,{}),l(this,R)["content-type"]="text/html; charset=UTF-8",typeof e=="object"?Pn(e,Oi.Stringify,!1,{}).then(n=>typeof t=="number"?_(this,H,G).call(this,n,t,r):_(this,H,G).call(this,n,t)):typeof t=="number"?_(this,H,G).call(this,e,t,r):_(this,H,G).call(this,e,t)));g(this,"redirect",(e,t)=>(l(this,D)??w(this,D,new Headers),l(this,D).set("Location",String(e)),this.newResponse(null,t??302)));g(this,"notFound",()=>(l(this,Xe)??w(this,Xe,()=>new Response),l(this,Xe).call(this,this)));w(this,_t,e),t&&(w(this,he,t.executionCtx),this.env=t.env,w(this,Xe,t.notFoundHandler),w(this,Nt,t.path),w(this,xt,t.matchResult))}get req(){return l(this,bt)??w(this,bt,new kn(l(this,_t),l(this,Nt),l(this,xt))),l(this,bt)}get event(){if(l(this,he)&&"respondWith"in l(this,he))return l(this,he);throw Error("This context has no FetchEvent")}get executionCtx(){if(l(this,he))return l(this,he);throw Error("This context has no ExecutionContext")}get res(){return w(this,pe,!1),l(this,se)||w(this,se,new Response("404 Not Found",{status:404}))}set res(e){if(w(this,pe,!1),l(this,se)&&e)try{for(const[t,r]of l(this,se).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const n=l(this,se).headers.getSetCookie();e.headers.delete("set-cookie");for(const s of n)e.headers.append("set-cookie",s)}else e.headers.set(t,r)}catch(t){if(t instanceof TypeError&&t.message.includes("immutable")){this.res=new Response(e.body,{headers:e.headers,status:e.status});return}else throw t}w(this,se,e),this.finalized=!0}get var(){return l(this,de)?Object.fromEntries(l(this,de)):{}}},_t=new WeakMap,bt=new WeakMap,de=new WeakMap,Ce=new WeakMap,he=new WeakMap,D=new WeakMap,R=new WeakMap,se=new WeakMap,pe=new WeakMap,Et=new WeakMap,Qe=new WeakMap,Xe=new WeakMap,xt=new WeakMap,Nt=new WeakMap,H=new WeakSet,G=function(e,t,r){if(l(this,pe)&&!r&&!t&&l(this,Ce)===200)return new Response(e,{headers:l(this,R)});if(t&&typeof t!="number"){const s=new Headers(t.headers);l(this,D)&&l(this,D).forEach((o,a)=>{a==="set-cookie"?s.append(a,o):s.set(a,o)});const i=br(s,l(this,R));return new Response(e,{headers:i,status:t.status??l(this,Ce)})}const n=typeof t=="number"?t:l(this,Ce);l(this,R)??w(this,R,{}),l(this,D)??w(this,D,new Headers),br(l(this,D),l(this,R)),l(this,se)&&(l(this,se).headers.forEach((s,i)=>{var o,a;i==="set-cookie"?(o=l(this,D))==null||o.append(i,s):(a=l(this,D))==null||a.set(i,s)}),br(l(this,D),l(this,R))),r??(r={});for(const[s,i]of Object.entries(r))if(typeof i=="string")l(this,D).set(s,i);else{l(this,D).delete(s);for(const o of i)l(this,D).append(s,o)}return new Response(e,{status:n,headers:l(this,D)})},Un),k="ALL",Mi="all",ji=["get","post","put","delete","options","patch"],On="Can not add a route since the matcher is already built.",In=class extends Error{},Ai="__COMPOSED_HANDLER",Bi=e=>e.text("404 Not Found",404),Cn=(e,t)=>"getResponse"in e?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),Mn=(zn=class{constructor(t={}){y(this,O);g(this,"get");g(this,"post");g(this,"put");g(this,"delete");g(this,"options");g(this,"patch");g(this,"all");g(this,"on");g(this,"use");g(this,"router");g(this,"getPath");g(this,"_basePath","/");y(this,Z,"/");g(this,"routes",[]);y(this,ge,Bi);g(this,"errorHandler",Cn);g(this,"onError",t=>(this.errorHandler=t,this));g(this,"notFound",t=>(w(this,ge,t),this));g(this,"fetch",(t,...r)=>_(this,O,zt).call(this,t,r[1],r[0],t.method));g(this,"request",(t,r,n,s)=>t instanceof Request?this.fetch(r?new Request(t,r):t,n,s):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${Je("/",t)}`,r),n,s)));g(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(_(this,O,zt).call(this,t.request,t,void 0,t.request.method))})});[...ji,Mi].forEach(i=>{this[i]=(o,...a)=>(typeof o=="string"?w(this,Z,o):_(this,O,He).call(this,i,l(this,Z),o),a.forEach(c=>{_(this,O,He).call(this,i,l(this,Z),c)}),this)}),this.on=(i,o,...a)=>{for(const c of[o].flat()){w(this,Z,c);for(const u of[i].flat())a.map(d=>{_(this,O,He).call(this,u.toUpperCase(),l(this,Z),d)})}return this},this.use=(i,...o)=>(typeof i=="string"?w(this,Z,i):(w(this,Z,"*"),o.unshift(i)),o.forEach(a=>{_(this,O,He).call(this,k,l(this,Z),a)}),this);const{strict:n,...s}=t;Object.assign(this,s),this.getPath=n??!0?t.getPath??Sn:Ri}route(t,r){const n=this.basePath(t);return r.routes.map(s=>{var o;let i;r.errorHandler===Cn?i=s.handler:(i=async(a,c)=>(await bn([],r.errorHandler)(a,()=>s.handler(a,c))).res,i[Ai]=s.handler),_(o=n,O,He).call(o,s.method,s.path,i)}),this}basePath(t){const r=_(this,O,ss).call(this);return r._basePath=Je(this._basePath,t),r}mount(t,r,n){let s,i;n&&(typeof n=="function"?i=n:(i=n.optionHandler,s=n.replaceRequest));const o=i?c=>{const u=i(c);return Array.isArray(u)?u:[u]}:c=>{let u;try{u=c.executionCtx}catch{}return[c.env,u]};s||(s=(()=>{const c=Je(this._basePath,t),u=c==="/"?0:c.length;return d=>{const f=new URL(d.url);return f.pathname=f.pathname.slice(u)||"/",new Request(f,d)}})());const a=async(c,u)=>{const d=await r(s(c.req.raw),...o(c));if(d)return d;await u()};return _(this,O,He).call(this,k,Je(t,"*"),a),this}},Z=new WeakMap,O=new WeakSet,ss=function(){const t=new Mn({router:this.router,getPath:this.getPath});return t.routes=this.routes,t},ge=new WeakMap,He=function(t,r,n){t=t.toUpperCase(),r=Je(this._basePath,r);const s={path:r,method:t,handler:n};this.router.add(t,r,[n,s]),this.routes.push(s)},Ut=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},zt=function(t,r,n,s){if(s==="HEAD")return(async()=>new Response(null,await _(this,O,zt).call(this,t,r,n,"GET")))();const i=this.getPath(t,{env:n}),o=this.router.match(s,i),a=new Ci(t,{path:i,matchResult:o,env:n,executionCtx:r,notFoundHandler:l(this,ge)});if(o[0].length===1){let u;try{u=o[0][0][0][0](a,async()=>{a.res=await l(this,ge).call(this,a)})}catch(d){return _(this,O,Ut).call(this,d,a)}return u instanceof Promise?u.then(d=>d||(a.finalized?a.res:l(this,ge).call(this,a))).catch(d=>_(this,O,Ut).call(this,d,a)):u??l(this,ge).call(this,a)}const c=bn(o[0],this.errorHandler,l(this,ge));return(async()=>{try{const u=await c(a);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return _(this,O,Ut).call(this,u,a)}})()},zn),Ft="[^/]+",ht=".*",pt="(?:|/.*)",gt=Symbol(),Hi=new Set(".\\+*[^]$()");function Li(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===ht||e===pt?1:t===ht||t===pt?-1:e===Ft?1:t===Ft?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var Er=(Jn=class{constructor(){y(this,Me);y(this,je);y(this,ee,Object.create(null))}insert(t,r,n,s,i){if(t.length===0){if(l(this,Me)!==void 0)throw gt;if(i)return;w(this,Me,r);return}const[o,...a]=t,c=o==="*"?a.length===0?["","",ht]:["","",Ft]:o==="/*"?["","",pt]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(c){const d=c[1];let f=c[2]||Ft;if(d&&c[2]&&(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f)))throw gt;if(u=l(this,ee)[f],!u){if(Object.keys(l(this,ee)).some(h=>h!==ht&&h!==pt))throw gt;if(i)return;u=l(this,ee)[f]=new Er,d!==""&&w(u,je,s.varIndex++)}!i&&d!==""&&n.push([d,l(u,je)])}else if(u=l(this,ee)[o],!u){if(Object.keys(l(this,ee)).some(d=>d.length>1&&d!==ht&&d!==pt))throw gt;if(i)return;u=l(this,ee)[o]=new Er}u.insert(a,r,n,s,i)}buildRegExpStr(){const r=Object.keys(l(this,ee)).sort(Li).map(n=>{const s=l(this,ee)[n];return(typeof l(s,je)=="number"?`(${n})@${l(s,je)}`:Hi.has(n)?`\\${n}`:n)+s.buildRegExpStr()});return typeof l(this,Me)=="number"&&r.unshift(`#${l(this,Me)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Me=new WeakMap,je=new WeakMap,ee=new WeakMap,Jn),Vi=(Gn=class{constructor(){y(this,Kt,{varIndex:0});y(this,St,new Er)}insert(e,t,r){const n=[],s=[];for(let o=0;;){let a=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{const u=`@\\${o}`;return s[o]=[u,c],o++,a=!0,u}),!a)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=s.length-1;o>=0;o--){const[a]=s[o];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(a)!==-1){i[c]=i[c].replace(a,s[o][1]);break}}return l(this,St).insert(i,t,n,l(this,Kt),r),n}buildRegExp(){let e=l(this,St).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,i,o)=>i!==void 0?(r[++t]=Number(i),"$()"):(o!==void 0&&(n[Number(o)]=++t),"")),[new RegExp(`^${e}`),r,n]}},Kt=new WeakMap,St=new WeakMap,Gn),jn=[],Fi=[/^$/,[],Object.create(null)],Wt=Object.create(null);function An(e){return Wt[e]??(Wt[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Wi(){Wt=Object.create(null)}function qi(e){var u;const t=new Vi,r=[];if(e.length===0)return Fi;const n=e.map(d=>[!/\*|\/:/.test(d[0]),...d]).sort(([d,f],[h,p])=>d?1:h?-1:f.length-p.length),s=Object.create(null);for(let d=0,f=-1,h=n.length;d<h;d++){const[p,x,b]=n[d];p?s[x]=[b.map(([C])=>[C,Object.create(null)]),jn]:f++;let I;try{I=t.insert(x,f,p)}catch(C){throw C===gt?new In(x):C}p||(r[f]=b.map(([C,L])=>{const te=Object.create(null);for(L-=1;L>=0;L--){const[m,V]=I[L];te[m]=V}return[C,te]}))}const[i,o,a]=t.buildRegExp();for(let d=0,f=r.length;d<f;d++)for(let h=0,p=r[d].length;h<p;h++){const x=(u=r[d][h])==null?void 0:u[1];if(!x)continue;const b=Object.keys(x);for(let I=0,C=b.length;I<C;I++)x[b[I]]=a[x[b[I]]]}const c=[];for(const d in o)c[d]=r[o[d]];return[i,c,s]}function Ge(e,t){if(e){for(const r of Object.keys(e).sort((n,s)=>s.length-n.length))if(An(r).test(t))return[...e[r]]}}var Ki=(Yn=class{constructor(){y(this,Ze);g(this,"name","RegExpRouter");y(this,Se);y(this,$e);w(this,Se,{[k]:Object.create(null)}),w(this,$e,{[k]:Object.create(null)})}add(e,t,r){var a;const n=l(this,Se),s=l(this,$e);if(!n||!s)throw new Error(On);n[e]||[n,s].forEach(c=>{c[e]=Object.create(null),Object.keys(c[k]).forEach(u=>{c[e][u]=[...c[k][u]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const c=An(t);e===k?Object.keys(n).forEach(u=>{var d;(d=n[u])[t]||(d[t]=Ge(n[u],t)||Ge(n[k],t)||[])}):(a=n[e])[t]||(a[t]=Ge(n[e],t)||Ge(n[k],t)||[]),Object.keys(n).forEach(u=>{(e===k||e===u)&&Object.keys(n[u]).forEach(d=>{c.test(d)&&n[u][d].push([r,i])})}),Object.keys(s).forEach(u=>{(e===k||e===u)&&Object.keys(s[u]).forEach(d=>c.test(d)&&s[u][d].push([r,i]))});return}const o=$n(t)||[t];for(let c=0,u=o.length;c<u;c++){const d=o[c];Object.keys(s).forEach(f=>{var h;(e===k||e===f)&&((h=s[f])[d]||(h[d]=[...Ge(n[f],d)||Ge(n[k],d)||[]]),s[f][d].push([r,i-u+c+1]))})}}match(e,t){Wi();const r=_(this,Ze,is).call(this);return this.match=(n,s)=>{const i=r[n]||r[k],o=i[2][s];if(o)return o;const a=s.match(i[0]);if(!a)return[[],jn];const c=a.indexOf("",1);return[i[1][c],a]},this.match(e,t)}},Se=new WeakMap,$e=new WeakMap,Ze=new WeakSet,is=function(){const e=Object.create(null);return Object.keys(l(this,$e)).concat(Object.keys(l(this,Se))).forEach(t=>{e[t]||(e[t]=_(this,Ze,os).call(this,t))}),w(this,Se,w(this,$e,void 0)),e},os=function(e){const t=[];let r=e===k;return[l(this,Se),l(this,$e)].forEach(n=>{const s=n[e]?Object.keys(n[e]).map(i=>[i,n[e][i]]):[];s.length!==0?(r||(r=!0),t.push(...s)):e!==k&&t.push(...Object.keys(n[k]).map(i=>[i,n[k][i]]))}),r?qi(t):null},Yn),Ui=(Qn=class{constructor(e){g(this,"name","SmartRouter");y(this,De,[]);y(this,we,[]);w(this,De,e.routers)}add(e,t,r){if(!l(this,we))throw new Error(On);l(this,we).push([e,t,r])}match(e,t){if(!l(this,we))throw new Error("Fatal error");const r=l(this,De),n=l(this,we),s=r.length;let i=0,o;for(;i<s;i++){const a=r[i];try{for(let c=0,u=n.length;c<u;c++)a.add(...n[c]);o=a.match(e,t)}catch(c){if(c instanceof In)continue;throw c}this.match=a.match.bind(a),w(this,De,[a]),w(this,we,void 0);break}if(i===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(l(this,we)||l(this,De).length!==1)throw new Error("No active router has been determined yet.");return l(this,De)[0]}},De=new WeakMap,we=new WeakMap,Qn),wt=Object.create(null),Bn=(Xn=class{constructor(e,t,r){y(this,me);y(this,Te);y(this,A);y(this,Ae);y(this,et,0);y(this,j,wt);if(w(this,A,r||Object.create(null)),w(this,Te,[]),e&&t){const n=Object.create(null);n[e]={handler:t,possibleKeys:[],score:0},w(this,Te,[n])}w(this,Ae,[])}insert(e,t,r){w(this,et,++ts(this,et)._);let n=this;const s=Si(t),i=[];for(let c=0,u=s.length;c<u;c++){const d=s[c],f=s[c+1],h=xn(d,f),p=Array.isArray(h)?h[0]:d;if(Object.keys(l(n,A)).includes(p)){n=l(n,A)[p];const x=xn(d,f);x&&i.push(x[1]);continue}l(n,A)[p]=new Bn,h&&(l(n,Ae).push(h),i.push(h[1])),n=l(n,A)[p]}const o=Object.create(null),a={handler:r,possibleKeys:i.filter((c,u,d)=>d.indexOf(c)===u),score:l(this,et)};return o[e]=a,l(n,Te).push(o),n}search(e,t){var a;const r=[];w(this,j,wt);let s=[this];const i=En(t),o=[];for(let c=0,u=i.length;c<u;c++){const d=i[c],f=c===u-1,h=[];for(let p=0,x=s.length;p<x;p++){const b=s[p],I=l(b,A)[d];I&&(w(I,j,l(b,j)),f?(l(I,A)["*"]&&r.push(..._(this,me,Le).call(this,l(I,A)["*"],e,l(b,j))),r.push(..._(this,me,Le).call(this,I,e,l(b,j)))):h.push(I));for(let C=0,L=l(b,Ae).length;C<L;C++){const te=l(b,Ae)[C],m=l(b,j)===wt?{}:{...l(b,j)};if(te==="*"){const Re=l(b,A)["*"];Re&&(r.push(..._(this,me,Le).call(this,Re,e,l(b,j))),w(Re,j,m),h.push(Re));continue}if(d==="")continue;const[V,tt,ve]=te,ye=l(b,A)[V],ao=i.slice(c).join("/");if(ve instanceof RegExp){const Re=ve.exec(ao);if(Re){if(m[tt]=Re[0],r.push(..._(this,me,Le).call(this,ye,e,l(b,j),m)),Object.keys(l(ye,A)).length){w(ye,j,m);const Sr=((a=Re[0].match(/\//))==null?void 0:a.length)??0;(o[Sr]||(o[Sr]=[])).push(ye)}continue}}(ve===!0||ve.test(d))&&(m[tt]=d,f?(r.push(..._(this,me,Le).call(this,ye,e,m,l(b,j))),l(ye,A)["*"]&&r.push(..._(this,me,Le).call(this,l(ye,A)["*"],e,m,l(b,j)))):(w(ye,j,m),h.push(ye)))}}s=h.concat(o.shift()??[])}return r.length>1&&r.sort((c,u)=>c.score-u.score),[r.map(({handler:c,params:u})=>[c,u])]}},Te=new WeakMap,A=new WeakMap,Ae=new WeakMap,et=new WeakMap,j=new WeakMap,me=new WeakSet,Le=function(e,t,r,n){const s=[];for(let i=0,o=l(e,Te).length;i<o;i++){const a=l(e,Te)[i],c=a[t]||a[k],u={};if(c!==void 0&&(c.params=Object.create(null),s.push(c),r!==wt||n&&n!==wt))for(let d=0,f=c.possibleKeys.length;d<f;d++){const h=c.possibleKeys[d],p=u[c.score];c.params[h]=n!=null&&n[h]&&!p?n[h]:r[h]??(n==null?void 0:n[h]),u[c.score]=!0}}return s},Xn),zi=(Zn=class{constructor(){g(this,"name","TrieRouter");y(this,Be);w(this,Be,new Bn)}add(e,t,r){const n=$n(t);if(n){for(let s=0,i=n.length;s<i;s++)l(this,Be).insert(e,n[s],r);return}l(this,Be).insert(e,t,r)}match(e,t){return l(this,Be).search(e,t)}},Be=new WeakMap,Zn),Hn=class extends Mn{constructor(e={}){super(e),this.router=e.router??new Ui({routers:[new Ki,new zi]})}};async function Ji(e,t){var s,i,o;let r="";if(t!=null&&t.siyuanPrefix)r=t.siyuanPrefix;else for(let a=0;a<e.level;a++)r+="../";const n="2.10.5";return`<!DOCTYPE html>
<html lang="zh_CN" data-theme-mode="light" data-light-theme="daylight" data-dark-theme="midnight">
<head>
  ${((s=t==null?void 0:t.embedCode)==null?void 0:s.head)??""}
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="stylesheet" type="text/css" id="baseStyle" href="${r}stage/build/export/base.css?${n}"/>
  <script>
  function isNightTime() {
    const currentHour = new Date().getHours();
    return currentHour >= 18 || currentHour < 6;
  }
  document.write('<link rel="stylesheet" type="text/css" id="themeDefaultStyle" href="${r}appearance/themes/'+(isNightTime()?'midnight':'daylight')+'/theme.css?${n}"/>');
  <\/script>
  <link rel="stylesheet" type="text/css" href="${r}appearance/oceanpress.css"/>
  <title>${e.title}</title>
</head>
<body>
  ${((i=t==null?void 0:t.embedCode)==null?void 0:i.beforeBody)??""}
  <div class="protyle-wysiwyg protyle-wysiwyg--attr" id="preview">
  ${e.htmlContent}
  </div>
  <script src="${r}appearance/icons/material/icon.js?${n}"><\/script>
  <script src="${r}stage/build/export/protyle-method.js?${n}"><\/script>
  <script src="${r}stage/protyle/js/lute/lute.min.js?${n}"><\/script>
  <script>
    window.siyuan = {
      config: {
        appearance: {
          mode: isNightTime()?1:0,//主题 明亮=0 暗黑=1
          codeBlockThemeDark: "base16/dracula",
          codeBlockThemeLight: "github",
        },
        editor: {
          codeLineWrap: true,
          codeLigatures: false,
          plantUMLServePath: "https://www.plantuml.com/plantuml/svg/~1",
          codeSyntaxHighlightLineNum: true,
          katexMacros: JSON.stringify({}),
        },
      },
      languages: { copy: "复制" },
    };
    const cdn = "${r}stage/protyle";
    const previewElement = document.getElementById("preview");

    Protyle.highlightRender(previewElement, cdn);
    Protyle.mathRender(previewElement, cdn, false);
    Protyle.mermaidRender(previewElement, cdn);
    Protyle.flowchartRender(previewElement, cdn);
    Protyle.graphvizRender(previewElement, cdn);
    Protyle.chartRender(previewElement, cdn);
    Protyle.mindmapRender(previewElement, cdn);
    Protyle.abcRender(previewElement, cdn);
    Protyle.htmlRender(previewElement);
    Protyle.plantumlRender(previewElement, cdn);
    document.querySelectorAll(".protyle-action__copy").forEach((item) => {
      item.addEventListener("click", (event) => {
        navigator.clipboard.writeText(
          item.parentElement.nextElementSibling.textContent.trimEnd(),
        );
        event.preventDefault();
        event.stopPropagation();
      });
    });
  <\/script>
  ${((o=t==null?void 0:t.embedCode)==null?void 0:o.afterBody)??""}
</body>
</html>`}function Gi(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos")}function Ln(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&#(\d+);/g,(t,r)=>String.fromCharCode(Number(r)))}async function ne(e,t=Yi()){var n,s;if(e===void 0)return"";const r={...t,nodeStack:[...t.nodeStack]};if(t.nodeStack.find(i=>i.ID&&e.ID&&i.ID===e.ID))return mt("循环引用",[...t.nodeStack,e].map(i=>i.ID));if(r[e.Type]===void 0)return mt(`没有找到对应的渲染方法 ${e.Type}  ${(n=r.nodeStack[0].Properties)==null?void 0:n.title}`);{if(r.nodeStack.push(e),e.ID&&((s=t.nodeStack[0])!=null&&s.ID)){const o=await v.getDocByChildID(e.ID),a=t.nodeStack[0];(o==null?void 0:o.ID)!==void 0&&o.ID!==a.ID&&a.ID&&r.refs.add(o.ID)}const i=await r[e.Type](e);return r.nodeStack.pop(),i}}function mt(e,...t){return vt(e,...t),`<div class="ft__smaller ft__secondary b3-form__space--small">${e}</div>`}function Vn(e){var r,n;const t=atob(e.CodeBlockInfo??((n=(r=e.Children)==null?void 0:r.find(s=>s.Type==="NodeCodeBlockFenceInfoMarker"))==null?void 0:n.CodeBlockInfo)??"");return[["mindmap","mermaid","echarts","abc","graphviz","flowchart","plantuml"].includes(t),t]}const qt=String.raw;async function J(e,t){let r="";for await(const n of(e==null?void 0:e.Children)??[])r+=await ne(n,t);return r}function P(e,t={}){var s,i,o,a,c;(t==null?void 0:t.subtype_class)===void 0&&(t.subtype_class=(()=>{var d,f;const u=((d=e.ListData)==null?void 0:d.Typ)===1?"o":((f=e.ListData)==null?void 0:f.Typ)===3?"t":"u";if(e.Type==="NodeDocument")return"h1";if(e.Type==="NodeHeading")return`h${e.HeadingLevel}`;if(e.Type==="NodeList")return[u,"list"];if(e.Type==="NodeListItem")return[u,"li"];if(e.Type==="NodeParagraph")return["","p"];if(e.Type==="NodeImage")return["","img"];if(e.Type==="NodeBlockquote")return["","bq"];if(e.Type==="NodeSuperBlock")return["","sb"];if(e.Type==="NodeCodeBlock"){const[h,p]=Vn(e);return h?[p,"render-node"]:["","code-block"]}else return e.Type==="NodeTable"?["","table"]:e.Type==="NodeThematicBreak"?["","hr"]:e.Type==="NodeMathBlock"?["math","render-node"]:e.Type==="NodeIFrame"?["","iframe"]:e.Type==="NodeVideo"?["","iframe"]:""})());const r={};function n(u,d){r[u]=d}return e.ID&&(n("id",e.ID),n("data-node-id",e.ID)),(e==null?void 0:e.TextMarkType)==="tag"?n("data-type",e.TextMarkType??""):n("data-type",(t==null?void 0:t.data_type)??e.Type),(s=e.Properties)!=null&&s.updated&&n("updated",e.Properties.updated),t!=null&&t.subtype_class&&(typeof t.subtype_class=="string"?(n("data-subtype",t.subtype_class),n("class",t.subtype_class)):(t.subtype_class[0]!==""&&n("data-subtype",t.subtype_class[0]),t.subtype_class[1]!==""&&n("class",t.subtype_class[1]))),e.Properties&&Object.entries(e.Properties).forEach(([u,d])=>n(u,d)),(i=e.ListData)!=null&&i.Marker&&n("data-marker",atob(e.ListData.Marker)),((o=e.ListData)==null?void 0:o.Typ)===3&&((c=(a=e.Children)==null?void 0:a.find(u=>u.Type==="NodeTaskListItemMarker"))!=null&&c.TaskListItemChecked)&&(r.class=(r.class??"")+" protyle-task--done "),delete r.fold,e.Type==="NodeDocument"&&delete r.title,Object.entries(r).map(([u,d])=>`${u}="${d}"`).join(" ")}const K=async e=>"",xr=async e=>e.Data??"",Yi=()=>({...Qi,nodeStack:[],refs:new Set}),Qi={nodeStack:[],refs:new Set,async getTopPathPrefix(){const e=this.nodeStack[0];let t=".";if(e.Type==="NodeDocument"&&e.ID){const r=await v.getDocPathBySY(e);if(r){const n=r.split("/").length-3;for(let s=0;s<n;s++)t+="/.."}return t}else return console.log("未定义顶层元素非 NodeDocument 时的处理方式",e),""},async NodeDocument(e){var r,n,s,i,o;let t="";return this.nodeStack.length===1&&(t+=`<div style="min-height: 150px;" ${P(e)}>`,(r=e.Properties)!=null&&r["title-img"]&&(t+=`<div class="protyle-background__img" style="margin-bottom: 30px;position: relative;height: 16vh;${(n=e.Properties)==null?void 0:n["title-img"].replace(/assets/,await this.getTopPathPrefix()+"/assets")}"/>${(s=e.Properties)!=null&&s.icon?`<div style="position: absolute;bottom:-10px;left:15px;height: 80px;width: 80px;transition: var(--b3-transition);cursor: pointer;font-size: 68px;line-height: 80px;text-align: center;font-family: var(--b3-font-family-emoji);margin-right: 16px;"> &#x${(i=e.Properties)==null?void 0:i.icon} </div>`:""}</div>`),t+="</div>",t+=`<h1 ${P(e)} data-type="NodeHeading" class="h1">${(o=e.Properties)==null?void 0:o.title}</h1>`),t+=await J(e,this),t},async NodeHeading(e){const t=`h${e.HeadingLevel}`;let r=`<${t} ${P(e)}>${await J(e,this)}</${t}>`;const n=this.nodeStack[this.nodeStack.length-2];if((n==null?void 0:n.Type)==="NodeBlockQueryEmbedScript"){let s=!1;for(const i of e.Parent.Children??[])i===e?s=!0:i!==e&&i.Type==="NodeHeading"?s=!1:s&&(r+=`
`+await ne(i,this))}return r},NodeText:xr,async NodeList(e){return qt`<div ${P(e)}>${await J(e,this)}</div>`},async NodeListItem(e){var t,r,n,s,i;return qt`<div ${await P(e)}>
      <div class="protyle-action">
        ${((t=e.ListData)==null?void 0:t.Typ)===1?atob(((r=e.ListData)==null?void 0:r.Marker)??""):((n=e.ListData)==null?void 0:n.Typ)===3?`<svg><use xlink:href="#${(i=(s=e.Children)==null?void 0:s.find(o=>o.Type==="NodeTaskListItemMarker"))!=null&&i.TaskListItemChecked?"iconCheck":"iconUncheck"}"></use></svg>`:'<svg><use xlink:href="#iconDot"></use></svg>'}
      </div>
      ${await J(e,this)}
    </div>`},NodeTaskListItemMarker:K,async NodeParagraph(e){return`<div ${P(e)}><div spellcheck="false">${await J(e,this)}</div></div>`},async NodeTextMark(e){var s;const t=this;let r="";for(const i of(((s=e.TextMarkType)==null?void 0:s.split(" "))??[]).reverse())r===""?r=await n(e,i,e.TextMarkTextContent??""):r=await n(e,i,r);return r;async function n(i,o,a){var c;if(o==="inline-math")return`<span data-type="inline-math" data-subtype="math" data-content="${i.TextMarkInlineMathContent}" class="render-node"></span>`;if(o==="inline-memo")return`${a}<sup>（${i.TextMarkInlineMemoContent}）</sup>`;if(o==="block-ref"){let u="";if(i.TextMarkBlockRefID){const d=await v.getDocByChildID(i.TextMarkBlockRefID);d!=null&&d.ID?(u=`${await t.getTopPathPrefix()}${await v.getHPathByID_Node(d)}.html#${i.TextMarkBlockRefID}`,t.refs.add(d.ID)):vt(`未查找到${i.ID}所指向的文档节点 ${i.TextMarkBlockRefID}`)}else vt(`${i.ID} 块引用没有设定 ref id`);return`<span data-type="${i.TextMarkType}" data-subtype="${i.TextMarkBlockRefSubtype}" data-id="${i.TextMarkBlockRefID}"><a href="${u}">${a}</a></span>`}else if(o==="a"){let u=i.TextMarkAHref;return u!=null&&u.startsWith("assets/")&&(u=`${await t.getTopPathPrefix()}/${u}`),`<a href="${u}">${a}</a>`}else return"strong em u s mark sup sub kbd tag code strong code text".includes(o??"")?`<span ${P(i,{data_type:o})}>${a}</span>`:mt(`没有找到对应的渲染器 ${i.TextMarkType}  ${(c=t.nodeStack[0].Properties)==null?void 0:c.title}`)}},async NodeImage(e){var i,o,a,c;let t="";const r=(i=e.Children)==null?void 0:i.filter(u=>u.Type==="NodeLinkDest");(r==null?void 0:r.length)===1?t=await ne(r[0],this):r!=null&&r.length&&r.length>1&&vt("NodeImage 存在多个 LinkDest",e);let n="";const s=(o=e.Children)==null?void 0:o.filter(u=>u.Type==="NodeLinkTitle");return(s==null?void 0:s.length)===1?n=await ne(s[0],this):s!=null&&s.length&&s.length>1&&vt("NodeImage 存在多个 LinkTitle",e),`<span ${await P(e)} style="${((a=e.Properties)==null?void 0:a["parent-style"])??""}">
<img
  src="${t}"
  data-src="${t}"
  title="${n}"
  style="${((c=e.Properties)==null?void 0:c.style)??""}"
  loading="lazy"
/>
<span class="protyle-action__title">${n}</span></span>`},async NodeLinkDest(e){return/^(?:[a-z]+:)?\/\/|^(?:\/)/.test(e.Data??"")?e.Data??"":`${await this.getTopPathPrefix()}/${e.Data}`},NodeLinkTitle:xr,NodeKramdownSpanIAL:K,async NodeSuperBlock(e){return`<div ${P(e)} data-sb-layout="${Fn(e,"NodeSuperBlockLayoutMarker")}">${await J(e,this)}</div>`},NodeSuperBlockOpenMarker:K,NodeSuperBlockCloseMarker:K,NodeSuperBlockLayoutMarker:K,async NodeBlockQueryEmbed(e){return`<div ${P(e)} data-type="NodeBlockquote" class="bq">${await J(e,this)}</div>`},NodeOpenBrace:K,NodeCloseBrace:K,async NodeBlockQueryEmbedScript(e){const t=e.Data;if(!t)return console.log("no sql",e),qt`<pre>${t}</pre>`;let r="";const n=await mr.query_sql({stmt:Ln(t).replace(/_esc_newline_/g,`
`)}).catch(s=>{throw new Error(`sql error: ${s.message}
rawSql:${t}
unescapingSql:${Ln(t)}`)});for(const s of n){const i=await v.getNodeByID(s.id);if(i===void 0)return mt("未找到此块，可能为跨笔记引用",s.id,t);r+=await ne(i,this)}return r},async NodeBlockquote(e){return qt`<div ${P(e)}>${await J(e,this)}</div>`},NodeBlockquoteMarker:K,NodeCodeBlock:async e=>{var n,s,i,o;const[t,r]=Vn(e);return t?`<div ${P(e)} data-content="${Gi(((s=(n=e.Children)==null?void 0:n.find(a=>a.Type==="NodeCodeBlockCode"))==null?void 0:s.Data)??"")}">
        <div spin="1"></div>
        <div class="protyle-attr" contenteditable="false"></div>
      </div>`:`<div ${P(e)}>
        <div class="protyle-action">
          <span class="protyle-action--first protyle-action__language">${await ne((i=e.Children)==null?void 0:i.find(a=>a.Type==="NodeCodeBlockFenceInfoMarker"),void 0)}</span>
          <span class="fn__flex-1"></span><span class="protyle-icon protyle-icon--only protyle-action__copy"><svg><use xlink:href="#iconCopy"></use></svg></span>
        </div>
        ${await ne((o=e.Children)==null?void 0:o.find(a=>a.Type==="NodeCodeBlockCode"),void 0)}
      </div>`},NodeCodeBlockFenceInfoMarker:async e=>atob(e.CodeBlockInfo??""),NodeCodeBlockCode:async e=>`<div class="hljs" spellcheck="false">${e.Data}</div>`,NodeCodeBlockFenceOpenMarker:K,NodeCodeBlockFenceCloseMarker:K,async NodeTable(e){var t,r,n;return`<div ${P(e)}>
    <div>
      <table spellcheck="false">
        <colgroup>
        ${(t=e.TableAligns)==null?void 0:t.map(()=>"<col />").join("")}
        </colgroup>
        ${await ne((r=e.Children)==null?void 0:r.find(s=>s.Type==="NodeTableHead"),this)}
        <tbody>
        ${(await Promise.all(((n=e.Children)==null?void 0:n.filter(s=>s.Type==="NodeTableRow").map(s=>ne(s,this)))??[])).join(`
`)}
        </tbody>
      </table>
    </div>
  </div>`},async NodeTableHead(e){return`<${e.Data}>${await J(e,this)}</${e.Data}>`},async NodeTableRow(e){return`<tr>${await J(e,this)}</tr>`},async NodeTableCell(e){return`<td>${await J(e,this)}</td>`},NodeHTMLBlock:async e=>`<div ${P(e)}>${e.Data}</div>`,NodeThematicBreak:async e=>`<div ${P(e)}><div></div></div>`,NodeMathBlock:async e=>`<div ${P(e)} data-content="${Fn(e,"NodeMathBlockContent")}">
    <div spin="1"></div>
  </div>`,NodeMathBlockOpenMarker:K,NodeMathBlockCloseMarker:K,async NodeIFrame(e){var t;return` <div ${P(e)}>
    <div class="iframe-content">
    ${(t=e.Data)==null?void 0:t.replace(/src="assets\//,`src="${await this.getTopPathPrefix()}/assets/`)}
    </div>
  </div>`},async NodeVideo(e){return await this.NodeIFrame(e)},async NodeAudio(e){return await this.NodeIFrame(e)},NodeHeadingC8hMarker:K,async NodeSoftBreak(e){return"​"},async NodeBr(e){return`<${e.Data}>`},async NodeWidget(e){return`<div ${P(e)}><img src="${await this.getTopPathPrefix()}/assets/widget/${e.ID}.jpg"/></div>`},async NodeBackslash(e){var t;return e.Data===void 0||e.Data==="span"?`${await J(e,this)}`:mt(`未定义的 NodeBackslash 处理 ${e.Data}`,(t=this.nodeStack[0].Properties)==null?void 0:t.title)},NodeBackslashContent:xr};function Fn(e,t){var r,n;return(n=(r=e.Children)==null?void 0:r.find(s=>s.Type===t))==null?void 0:n.Data}function vt(...e){console.warn(`
`,...e)}var Xi=class{constructor(e,t){g(this,"writer");g(this,"encoder");g(this,"writable");g(this,"abortSubscribers",[]);g(this,"responseReadable");g(this,"aborted",!1);g(this,"closed",!1);this.writable=e,this.writer=e.getWriter(),this.encoder=new TextEncoder;const r=t.getReader();this.abortSubscribers.push(async()=>{await r.cancel()}),this.responseReadable=new ReadableStream({async pull(n){const{done:s,value:i}=await r.read();s?n.close():n.enqueue(i)},cancel:()=>{this.abort()}})}async write(e){try{typeof e=="string"&&(e=this.encoder.encode(e)),await this.writer.write(e)}catch{}return this}async writeln(e){return await this.write(e+`
`),this}sleep(e){return new Promise(t=>setTimeout(t,e))}async close(){try{await this.writer.close()}catch{}this.closed=!0}async pipe(e){this.writer.releaseLock(),await e.pipeTo(this.writable,{preventClose:!0}),this.writer=this.writable.getWriter()}onAbort(e){this.abortSubscribers.push(e)}abort(){this.aborted||(this.aborted=!0,this.abortSubscribers.forEach(e=>e()))}},Wn=()=>{const e=typeof Bun<"u"?Bun.version:void 0;if(e===void 0)return!1;const t=e.startsWith("1.1")||e.startsWith("1.0")||e.startsWith("0.");return Wn=()=>t,t},Zi=new WeakMap,eo=(e,t,r)=>{const{readable:n,writable:s}=new TransformStream,i=new Xi(s,n);return Wn()&&e.req.raw.signal.addEventListener("abort",()=>{i.closed||i.abort()}),Zi.set(i.responseReadable,e),(async()=>{try{await t(i)}catch(o){o===void 0||console.error(o)}finally{i.close()}})(),e.newResponse(i.responseReadable)};function to(){const e=new Hn;return e.get("/",t=>t.redirect("/index.html")),e.get("/assets/*",qn),e.get("*",async t=>{const r=decodeURIComponent(t.req.path),n=await ro(r).catch(async s=>{if(s.message.includes("not doc"))return await qn(t);throw s});if(n instanceof Error)throw n;return typeof n=="string"?t.html(n):n}),e}async function qn(e){const t=e.req.path,r="/assets/widget/",n=t.startsWith(r),s=`${ze.value.apiPrefix}${n?"/api/file/getFile":t}`,i=await fetch(s,{headers:{Authorization:`Token ${ze.value.authorized}`},method:n?"POST":"GET",body:n?JSON.stringify({path:`/data/storage/oceanpress/widget_img/${t.substring(r.length)}`}):void 0}),o=i.body;return o?(e.status(i.status),eo(e,async a=>{const c=o.getReader();for(;;){const u=await c.read();if(u.done){a.close();break}else a.write(u.value)}})):e.text("响应体为 null",500,{"Content-Type":"text/plain"})}async function ro(e){var n;const t=decodeURIComponent(e).replace(/\#(.*)?$/,"").replace(/\.html$/,""),r=await mn(t);return await Ji({title:((n=r.Properties)==null?void 0:n.title)||"",htmlContent:await ne(r),level:e.split("/").length-1},{...ze.value.cdn,embedCode:ze.value.embedCode})}const Nr="/oceanpress_preview/",no=`${Nr}configs`;v.getItem=io,v.setItem=so,vi(!0);function so(e,t){}function io(e){}const oo=to(),yt=new Hn;yt.use("*",async(e,t)=>{console.log("[c]",e.req.path),await t()}),yt.post(no,async e=>{const t=await e.req.json();return console.log("接收配置文件完毕",t),fn(t),e.json({ok:!0})}),yt.all(`${Nr}*`,async e=>{const t=e.req.path.substring(Nr.length);return oo.request(t)}),yt.notFound(async e=>fetch(e.req.raw)),yt.fire(),self.addEventListener("install",e=>{console.log("sw installed🎉",e),self.skipWaiting()})})();
